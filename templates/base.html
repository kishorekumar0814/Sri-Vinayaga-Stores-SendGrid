<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Sri Vinayaga Stores</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
  <script>
      if ("serviceWorker" in navigator) {
          navigator.serviceWorker.register("/static/service-worker.js");
      }
  </script>
  <meta name="theme-color" content="#2b7a78">
  <link rel="apple-touch-icon" href="/static/icons/icon-192.png">
</head>
<body>
  <div class="layout">
    <nav id="sideNav" class="sidenav">
      <button id="navToggle" class="nav-toggle">☰</button>
      <ul>
        <li><a href="{{ url_for('home') }}">Home</a></li>
        <li><a href="{{ url_for('customer_login') }}">Customer</a></li>
        <li><a href="{{ url_for('admin_security') }}">Admin</a></li>
      </ul>
    </nav>

    <main class="main">
      <header class="site-header">
        <h1 class="shop-name">Sri Vinayaga Stores</h1>
        <p><center><i>Pillaiyar Kuppam, Vellore - 09.</i></center><p>
        <div class="quote-marquee"><marquee behavior="scroll" direction="left"><b><i>fresh daily groceries &nbsp &nbsp &nbsp &nbsp • &nbsp &nbsp &nbsp &nbsp friendy service &nbsp &nbsp &nbsp &nbsp • &nbsp &nbsp &nbsp &nbsp  quality you can trust</i></b></marquee></div>
        <div class="top-links">
          {% if session.get('role') == 'admin' %}
            <a class="badge" href="{{ url_for('admin_dashboard') }}">Admin: {{ session.get('admin_name') }}</a>
            <a class="btn" href="{{ url_for('admin_logout') }}">Logout</a>
          {% elif session.get('role') == 'customer' %}
            <a class="badge" href="{{ url_for('customer_dashboard') }}">Customer: {{ session.get('customer_name') }}</a>
            <a class="btn" href="{{ url_for('customer_logout') }}">Logout</a>
          {% else %}
            <!-- not logged in -->
          {% endif %}
        </div>
      </header>

      <section class="content">
        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            <div class="flash-area">
            {% for cat, msg in messages %}
              <div class="flash {{cat}}">{{ msg }}</div>
            {% endfor %}
            </div>
          {% endif %}
        {% endwith %}

        {% block content %}{% endblock %}
      </section>

      <footer class="site-footer">
        <p>© Sri Vinayaga Stores - 2025 - [Site Under Development & Testing]</p>
      </footer>
    </main>
  </div>

<script src="{{ url_for('static', filename='js/main.js') }}"></script>
<script>
  if ("serviceWorker" in navigator) {
    window.addEventListener("load", () => {
      navigator.serviceWorker
        .register("{{ url_for('static', filename='service-worker.js') }}")
        .then(reg => console.log("Service Worker registered!", reg))
        .catch(err => console.log("Service Worker failed:", err));
    });
  }
  </script>
  <!-- Add to Home Screen Prompt -->
  <script>
  let deferredPrompt;
  window.addEventListener("beforeinstallprompt", (e) => {
      e.preventDefault();
      deferredPrompt = e;
      document.getElementById("install-btn").style.display = "block"; // show custom button
  });

  document.getElementById("install-btn").addEventListener("click", async () => {
      document.getElementById("install-btn").style.display = "none";
      deferredPrompt.prompt();
      const { outcome } = await deferredPrompt.userChoice;
      console.log(`User response: ${outcome}`);
      deferredPrompt = null;
  });
  </script>
</body>
</html>
