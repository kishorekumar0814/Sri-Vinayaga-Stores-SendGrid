<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Sri Vinayaga Stores</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
  <meta name="theme-color" content="#2b7a78">
  <link rel="apple-touch-icon" href="/static/icons/icon-192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='favicon-32x32.png') }}">
  <link rel="icon" type="image/png" sizes="16x16" href="{{ url_for('static', filename='favicon-16x16.png') }}">

</head>
<body>
  <div class="layout">
    <nav id="sideNav" class="sidenav">
      <button id="navToggle" class="nav-toggle">â˜°</button>
      <ul>
        <li><a href="{{ url_for('home') }}">Home</a></li>
        <li><a href="{{ url_for('customer_login') }}">Customer</a></li>
        <li><a href="{{ url_for('admin_security') }}">Admin</a></li>
        <li>
        <button id="install-btn" 
          style="
            display:none; 
            width: 70%;
            margin-top:10px;
            padding:10px 18px; 
            background:#2b7a78; 
            color:white; 
            border:1px solid #ffffff; 
            border-radius:6px; 
            cursor:pointer;">
           Install App ðŸ¡»
        </button>
        </li>
        <li>
        <button id="share-btn"
          style="
            width: 70%;
            margin-top:10px;
            padding:10px 18px;
            background:#2b7a78;
            color:white;
            border:1px solid #ffffff;
            border-radius:6px;
            cursor:pointer;">
          Share App ðŸ”—
        </button>
        </li>
      </ul>
    </nav>

    <main class="main">
      <header class="site-header">
        <h1 class="shop-name">Sri Vinayaga Stores</h1>
        <p><center><i>Pillaiyar Kuppam, Vellore - 09.</i></center><p>
        <div class="quote-marquee"><marquee behavior="scroll" direction="left"><b><i>fresh daily groceries &nbsp &nbsp &nbsp &nbsp â€¢ &nbsp &nbsp &nbsp &nbsp friendy service &nbsp &nbsp &nbsp &nbsp â€¢ &nbsp &nbsp &nbsp &nbsp  quality you can trust</i></b></marquee></div>
        <div class="top-links">
          {% if session.get('role') == 'admin' %}
            <a class="badge" href="{{ url_for('admin_dashboard') }}">Admin: {{ session.get('admin_name') }}</a>
            <a class="btn" href="{{ url_for('admin_logout') }}">Logout</a>
          {% elif session.get('role') == 'customer' %}
            <a class="badge" href="{{ url_for('customer_dashboard') }}">Customer: {{ session.get('customer_name') }}</a>
            <a class="btn" href="{{ url_for('customer_logout') }}">Logout</a>
          {% else %}
            <!-- not logged in -->
          {% endif %}
        </div>
      </header>

      <section class="content">
        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            <div class="flash-area">
            {% for cat, msg in messages %}
              <div class="flash {{cat}}">{{ msg }}</div>
            {% endfor %}
            </div>
          {% endif %}
        {% endwith %}

        {% block content %}{% endblock %}
      </section>
      <!-- <button id="install-btn" style="display:none; position:fixed; bottom:20px; right:20px; padding:10px 18px; background:#2b7a78; color:white; border: 2px solid #357ABD;  border-radius:6px; cursor:pointer; z-index:1000;">
        Install App
      </button> -->

      <footer class="site-footer">
        <p>Â© Sri Vinayaga Stores - 2025 - [Site Under Development & Testing]</p>
      </footer>
    </main>
  </div>

<script src="{{ url_for('static', filename='js/main.js') }}"></script>
<script>
  if ("serviceWorker" in navigator) {
    window.addEventListener("load", () => {
      navigator.serviceWorker
        .register("{{ url_for('static', filename='service-worker.js') }}")
        .then(reg => console.log("Service Worker registered!", reg))
        .catch(err => console.log("Service Worker failed:", err));
    });
  }
  </script>
  <!-- Add to Home Screen Prompt -->
  <script>
  let deferredPrompt;
  window.addEventListener("beforeinstallprompt", (e) => {
      e.preventDefault();
      deferredPrompt = e;
      document.getElementById("install-btn").style.display = "block"; // show custom button
  });

  document.getElementById("install-btn").addEventListener("click", async () => {
      document.getElementById("install-btn").style.display = "none";
      deferredPrompt.prompt();
      const { outcome } = await deferredPrompt.userChoice;
      console.log(`User response: ${outcome}`);
      deferredPrompt = null;
  });
  </script>
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register("{{ url_for('static', filename='service-worker.js') }}")
        .then(() => console.log("Service Worker Registered"))
        .catch(err => console.error("Service Worker registration failed:", err));
    }
  </script>
  <script>
  // SHARE BUTTON FUNCTIONALITY
    document.getElementById("share-btn").addEventListener("click", async () => {

        const shareData = {
            title: "Check this app!",
            text: "Install this app â€“ very useful!",
            url: window.location.origin
        };

        if (navigator.share) {
            try {
                await navigator.share(shareData);
                console.log("Shared successfully");
            } catch (err) {
                console.log("Share canceled");
            }
        } else {
            // Fallback: Copy link to clipboard
            navigator.clipboard.writeText(window.location.origin);
            alert("Link copied to clipboard!");
        }
    });
  </script>  


</body>
</html>
